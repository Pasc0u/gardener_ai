<div id="chat_topic">
  <h1> Chat about <%= @chat.topic %> </h1>
</div>
<h1> for <%= @plant.species %></h1>

<%= link_to "Go back to your plant", plant_path(@plant) %>

<div id="messages">
  <% @chat.messages.each do |message| %>
    <% if message.role == "user" %>
      <div class="d-flex justify-content-end mb-2">
        <div class="bg-white px-3 pb-0 pt-3 rounded-pill">
          <%= raw(render_markdown(message.content)) %>
          <% if message.file.attached? %> 
            <strong>File:</strong>
            <%= link_to message.file.filename, rails_blob_path(message.file, disposition: "attachment") %>
          <% end %>
        </div>
      </div>
    <% elsif message.role == "assistant" %>
      <div class="d-flex justify-content-start mb-5">
        <div class="px-3 pb-0 pt-3">
          <%= raw(render_markdown(message.content)) %>
        </div>
      </div>
    <% end %>
  <% end %>
</div>

<div id="new_message" class="mt-3">
  <%= simple_form_for [@chat, @message] do |f| %>
    <%= f.input :content, placeholder: "Ask a question", required: true, label: false %>
    <%= f.input :file, as: :file, label: false %>
    <%= f.submit "Ask", class: "btn btn-primary" %>
  <% end %>
</div>
